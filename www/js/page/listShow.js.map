{"version":3,"names":[],"mappings":"","sources":["page/listShow.js"],"sourcesContent":["document.addEventListener('DOMContentLoaded', function () {\r\n  class listShow extends parent {\r\n    constructor() {\r\n      super()\r\n      this.state = {\r\n        $page: $('#js-page'),\r\n        limit: 10,\r\n        skip: 0,\r\n        isFetch: false,\r\n        alwayNum: 0,\r\n        noNum: 0,\r\n        sumNum: 847,\r\n\r\n        $sumNum: $('#js-sumNum'),\r\n        $alwayNum: $('#js-alwayNum'),\r\n        $noNum: $('#js-noNum'),\r\n        \r\n        data1: [],\r\n        $data1: $('#js-data1'),\r\n\r\n        // data2: [],\r\n        // $data2: $('#js-data2'),\r\n\r\n        // data3: [],\r\n        // $data3: $('#js-data3'),\r\n\r\n        // data4: [],\r\n        // $data4: $('#js-data4'),\r\n\r\n        list: [],\r\n        $list: $('#js-list'),\r\n        $arrowTop: $('#js-scroll-top'),\r\n      };\r\n      this.init()\r\n\r\n      this.addMore(this.fetchList.bind(this))\r\n\r\n      setInterval(() => {\r\n        this.fetchData1()\r\n      }, 1000 * 5 * 60)\r\n    }\r\n    init() {\r\n      this.load()\r\n    }\r\n    load() {\r\n      this.fetchNum().then(res => {\r\n        this.state.alwayNum = res || 0\r\n        this.state.noNum = this.state.sumNum - (res || 0)\r\n        \r\n        // 数字信息\r\n        this.state.$sumNum.text(this.state.sumNum)\r\n        this.state.$alwayNum.text(this.state.alwayNum)\r\n        this.state.$noNum.text(this.state.noNum)\r\n      })\r\n      \r\n      this.fetchData1()\r\n\r\n      // this.fetchData2().then(res => {\r\n      //   this.state.data2 = res\r\n\r\n      //   let fragment = this.createListFragment(res, (v) => {\r\n      //     return `\r\n      //       <div class=\"listShow-scroll-item-wrap\">\r\n      //         <div class=\"listShow-scroll-item\">\r\n      //           <img src=\"assets/img/git.png\" alt=\"img\">\r\n      //           <span>${v.user && v.user.nickname || '幸运儿'}</span>\r\n      //           <span>${moment(v.createdAt).fromNow()}</span>\r\n      //           <span class=\"listShow-scroll-item-font\">抽中${v.materialAward && v.materialAward.name}</span>\r\n      //         </div>\r\n      //       </div>\r\n      //     `\r\n      //   })\r\n      //   this.state.$data2.append(fragment)\r\n      // })\r\n\r\n      // this.fetchData3().then(res => {\r\n      //   this.state.data3 = res\r\n\r\n      //   let fragment = this.createListFragment(res, (v) => {\r\n      //     return `\r\n      //       <div class=\"listShow-scroll-item-wrap\">\r\n      //         <div class=\"listShow-scroll-item\">\r\n      //           <img src=\"assets/img/red.png\" alt=\"img\">\r\n      //           <span>${v.user && v.user.nickname || '幸运儿'}</span>\r\n      //           <span>${moment(v.createdAt).fromNow()}</span>\r\n      //           <span class=\"listShow-scroll-item-font\">抽中${v.value || 0}元红包</span>\r\n      //         </div>\r\n      //       </div>\r\n      //     `\r\n      //   })\r\n      //   this.state.$data3.append(fragment)\r\n      // })\r\n\r\n      // this.fetchData4().then(res => {\r\n      //   this.state.data4 = res\r\n\r\n      //   let fragment = this.createListFragment(res, (v) => {\r\n      //     return `\r\n      //       <div class=\"listShow-scroll-item-wrap\">\r\n      //         <div class=\"listShow-scroll-item\">\r\n      //           <img src=\"assets/img/iphone.png\" alt=\"img\">\r\n      //           <span>${v.user && v.user.nickname || '幸运儿'}</span>\r\n      //           <span>${moment(v.createdAt).fromNow()}</span>\r\n      //           <span class=\"listShow-scroll-item-font\">${v.value || 0}优惠券</span>\r\n      //         </div>\r\n      //       </div>\r\n      //     `\r\n      //   })\r\n      //   this.state.$data4.append(fragment)\r\n        \r\n      // })\r\n\r\n      this.fetchList()\r\n      \r\n      this.ready()\r\n    }\r\n    ready() {\r\n      this.state.$arrowTop.on('tap', () => {\r\n        //滚动顶部\r\n        this.scrollTop();\r\n      })\r\n    }\r\n    awardType(v){\r\n      if (v.awardType === 'material') return v.materialAward && v.materialAward.name\r\n      if (v.awardType === 'taobao_coupon') return `${v.value || 0}元优惠券`\r\n      if (v.awardType === 'regular_red_bag' || v.awardType === 'virtual_red_bag') return `${v.value}元红包`\r\n      if (v.awardType === 'buy_times_award') return v.buyTimesAward && v.buyTimesAward.name\r\n    }\r\n    fetchNum(){\r\n      return this.fetch({\r\n        method: 'get',\r\n        url: `${this.baseUriApi}/awardrecords/getCurrentBuyTimesAwardCount`,\r\n      })\r\n    }\r\n    fetchData1() {\r\n      return this.fetch({\r\n        method: 'get',\r\n        url: `${this.baseUriApi}/awardrecords/getCurrentAwardRecords`,\r\n        // params: {\r\n        //   type: 'buy_times_award'\r\n        // }\r\n      }).then(res => {\r\n        this.state.data1 = res\r\n        this.state.$data1.empty()\r\n\r\n        let fragment = this.createListFragment(res, (v) => {\r\n          return `\r\n            <div class=\"listShow-scroll-item-wrap\">\r\n              <div class=\"listShow-scroll-item\">\r\n                <img src=\"assets/img/git.png\" alt=\"img\">\r\n                <span>${v.user && v.user.nickname || '幸运儿'}</span>\r\n                <span>${moment(v.createdAt).fromNow()}</span>\r\n                <span class=\"listShow-scroll-item-font\">抽中${this.awardType(v)}</span>\r\n              </div>\r\n            </div>\r\n          `\r\n        })\r\n\r\n        this.state.$data1.append(fragment)\r\n\r\n        // const height = this.state.$data1.height()\r\n\r\n        // var tt=document.styleSheets[0];\r\n        // tt.deleteRule(6);//清除之前写入的动画样式\r\n        // tt.insertRule(`\r\n        //   @keyframes toTop{\r\n        //     0%{top: 0;} \r\n        //     100%{top: -${height / 7.5}vw}\r\n        //   }\r\n        // `,6);\r\n        // $('.listShow-title')[0].style.animate = 'toTop 300s linear infinite'\r\n      })\r\n    }\r\n    // fetchData2() {\r\n    //   return this.fetch({\r\n    //     method: 'get',\r\n    //     url: `${this.baseUriApi}/awardrecords/getCurrentAwardRecords`,\r\n    //     params: {\r\n    //       type: 'material'\r\n    //     }\r\n    //   })\r\n    // }\r\n    // fetchData3() {\r\n    //   return this.fetch({\r\n    //     method: 'get',\r\n    //     url: `${this.baseUriApi}/awardrecords/getCurrentAwardRecords`,\r\n    //     params: {\r\n    //       type: 'virtual_red_bag'\r\n    //     }\r\n    //   })\r\n    // }\r\n    // fetchData4() {\r\n    //   return this.fetch({\r\n    //     method: 'get',\r\n    //     url: `${this.baseUriApi}/awardrecords/getCurrentAwardRecords`,\r\n    //     params: {\r\n    //       type: 'taobao_coupon'\r\n    //     }\r\n    //   })\r\n    // }\r\n    fetchList() {\r\n      this.state.isFetch = true\r\n\r\n      return this.fetch({\r\n        method: 'get',\r\n        url: `${this.baseUriApi}/posts`,\r\n        params: {\r\n          filter: {\r\n            type: 2,\r\n            limit: 10,\r\n            skip: this.state.skip\r\n          }\r\n        },\r\n      }).then(res => {\r\n        if (!res) return\r\n        // console.log(this.state.list, res, 'data')\r\n        // const data = [...this.state.list, ...res]\r\n        const data = res\r\n        \r\n        // this.state.$list.empty()\r\n        // this.state.list = data\r\n\r\n        if (!data) return \r\n\r\n        let fragment = this.createListFragment(data, (v) => {\r\n          return v && `\r\n            <div class=\"listShow-user\">\r\n              <div class=\"listShow-left\">\r\n                <img src=${v.user && v.user.avatar || 'assets/img/avatar.png'} alt=\"img\">\r\n              </div>\r\n              <div class=\"listShow-right\">\r\n                <div class=\"listShow-right-name\">${v.user && v.user.avatar && v.user.avatar.nickname || '中奖用户'}</div>\r\n                <div class=\"listShow-right-content\">${v.titleRaw || ''}</div>\r\n                ${v.images ? `<div class=\"listShow-right-img\"><img src=\"${v.images && v.images[0]}\" alt=\"img\"></div>` : ''}\r\n              </div>\r\n            </div>\r\n          `\r\n        })\r\n        this.state.$list.append(fragment)\r\n        \r\n        this.state.skip = this.state.skip + this.state.limit\r\n        this.state.isFetch = false\r\n      })\r\n    }\r\n    addMore(cb) {\r\n      const wh = window.screen.height;\r\n      document.addEventListener(\"scroll\", e => {\r\n        let lh = this.state.$page.height();\r\n        const sh = document.body.scrollTop || e.target.documentElement.scrollTop\r\n        if (sh + wh > lh && !this.state.isFetch) cb && cb();\r\n      });\r\n    }\r\n\r\n    createListFragment(arr, cb){\r\n      let fragment = document.createDocumentFragment()\r\n      arr.forEach((v) => {\r\n        let html = cb && cb(v)\r\n        fragment.appendChild($(html)[0])\r\n      })\r\n\r\n      return fragment\r\n    }\r\n    // render(arr = []){\r\n    //   let fragment = this.createListFragment(arr)\r\n    //   this.state.$list.append(fragment)\r\n    // }\r\n  }\r\n\r\n  new listShow()\r\n});\r\n"],"file":"listShow.js"}