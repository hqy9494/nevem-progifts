{"version":3,"names":[],"mappings":"","sources":["page/listShow.js"],"sourcesContent":["document.addEventListener('DOMContentLoaded', function () {\n  class listShow extends parent {\n    constructor() {\n      super()\n      this.state = {\n        $page: $('#js-page'),\n        limit: 10,\n        skip: 0,\n        isFetch: false,\n        alwayNum: 0,\n        noNum: 0,\n        sumNum: 847,\n\n        $sumNum: $('#js-sumNum'),\n        $alwayNum: $('#js-alwayNum'),\n        $noNum: $('#js-noNum'),\n        \n        data1: [],\n        $data1: $('#js-data1'),\n\n        data2: [],\n        $data2: $('#js-data2'),\n\n        data3: [],\n        $data3: $('#js-data3'),\n\n        data4: [],\n        $data4: $('#js-data4'),\n\n        list: [],\n        $list: $('#js-list')\n      };\n      this.init()\n\n      this.addMore(this.fetchList.bind(this))\n    }\n    init() {\n      this.load()\n    }\n    load() {\n      this.fetchNum().then(res => {\n        this.state.alwayNum = res || 0\n        this.state.noNum = this.state.sumNum - (res || 0)\n        \n        // 数字信息\n        this.state.$sumNum.text(this.state.sumNum)\n        this.state.$alwayNum.text(this.state.alwayNum)\n        this.state.$noNum.text(this.state.noNum)\n      })\n      \n      this.fetchData1().then(res => {\n        this.state.data1 = res\n\n        let fragment = this.createListFragment(res, (v) => {\n          return `\n            <div class=\"listShow-scroll-item-wrap\">\n              <div class=\"listShow-scroll-item\">\n                <img src=\"assets/img/git.png\" alt=\"img\">\n                <span>${v.user && v.user.nickname || '幸运儿'}</span>\n                <span>${moment(v.createdAt).fromNow()}</span>\n                <span class=\"listShow-scroll-item-font\">${v.buyTimesAward && v.buyTimesAward.name}</span>\n              </div>\n            </div>\n          `\n        })\n        this.state.$data1.append(fragment)\n        \n        // console.log(this.state.$data1, 'this.state.$data1')\n        \n        \n        // console.log(this.state.$data1.height(), 'this.state.$data1')\n      })\n\n      this.fetchData2().then(res => {\n        this.state.data2 = res\n\n        let fragment = this.createListFragment(res, (v) => {\n          return `\n            <div class=\"listShow-scroll-item-wrap\">\n              <div class=\"listShow-scroll-item\">\n                <img src=\"assets/img/git.png\" alt=\"img\">\n                <span>${v.user && v.user.nickname || '幸运儿'}</span>\n                <span>${moment(v.createdAt).fromNow()}</span>\n                <span class=\"listShow-scroll-item-font\">${v.materialAward && v.materialAward.name}</span>\n              </div>\n            </div>\n          `\n        })\n        this.state.$data2.append(fragment)\n      })\n\n      this.fetchData3().then(res => {\n        this.state.data3 = res\n\n        let fragment = this.createListFragment(res, (v) => {\n          return `\n            <div class=\"listShow-scroll-item-wrap\">\n              <div class=\"listShow-scroll-item\">\n                <img src=\"assets/img/git.png\" alt=\"img\">\n                <span>${v.user && v.user.nickname || '幸运儿'}</span>\n                <span>${moment(v.createdAt).fromNow()}</span>\n                <span class=\"listShow-scroll-item-font\">${v.value || 0}红包</span>\n              </div>\n            </div>\n          `\n        })\n        this.state.$data3.append(fragment)\n      })\n\n      this.fetchData4().then(res => {\n        this.state.data4 = res\n\n        let fragment = this.createListFragment(res, (v) => {\n          return `\n            <div class=\"listShow-scroll-item-wrap\">\n              <div class=\"listShow-scroll-item\">\n                <img src=\"assets/img/git.png\" alt=\"img\">\n                <span>${v.user && v.user.nickname || '幸运儿'}</span>\n                <span>${moment(v.createdAt).fromNow()}</span>\n                <span class=\"listShow-scroll-item-font\">${v.value || 0}优惠券</span>\n              </div>\n            </div>\n          `\n        })\n        this.state.$data4.append(fragment)\n        \n      })\n\n      this.fetchList()\n    }\n    ready() {\n      \n    }\n    fetchNum(){\n      return this.fetch({\n        method: 'get',\n        url: `${this.baseUriApi}/awardrecords/getCurrentBuyTimesAwardCount`,\n      })\n    }\n    fetchData1() {\n      return this.fetch({\n        method: 'get',\n        url: `${this.baseUriApi}/awardrecords/getCurrentAwardRecords`,\n        params: {\n          type: 'buy_times_award'\n        }\n      })\n    }\n    fetchData2() {\n      return this.fetch({\n        method: 'get',\n        url: `${this.baseUriApi}/awardrecords/getCurrentAwardRecords`,\n        params: {\n          type: 'material'\n        }\n      })\n    }\n    fetchData3() {\n      return this.fetch({\n        method: 'get',\n        url: `${this.baseUriApi}/awardrecords/getCurrentAwardRecords`,\n        params: {\n          type: 'virtual_red_bag'\n        }\n      })\n    }\n    fetchData4() {\n      return this.fetch({\n        method: 'get',\n        url: `${this.baseUriApi}/awardrecords/getCurrentAwardRecords`,\n        params: {\n          type: 'taobao_coupon'\n        }\n      })\n    }\n    fetchList() {\n      this.state.isFetch = true\n\n      return this.fetch({\n        method: 'get',\n        url: `${this.baseUriApi}/posts`,\n        params: {\n          filter: {\n            type: 2,\n            limit: 10,\n            skip: this.state.skip\n          }\n        },\n      }).then(res => {\n        console.log(this.state.list, res, 'data')\n        const data = [...this.state.list, ...res]\n        \n        this.state.$list.empty()\n        this.state.list = data\n\n        if (!data) return \n\n        let fragment = this.createListFragment(data, (v) => {\n          return v && `\n            <div class=\"listShow-user\">\n              <div class=\"listShow-left\">\n                <img src=${v.user && v.user.avatar || 'assets/img/avatar.png'} alt=\"img\">\n              </div>\n              <div class=\"listShow-right\">\n                <div class=\"listShow-right-name\">${v.user && v.user.avatar && v.user.avatar.nickname || '中奖用户'}</div>\n                <div class=\"listShow-right-content\">${v.titleRaw || ''}</div>\n                ${v.images ? `<div class=\"listShow-right-img\"><img src=\"${v.images && v.images[0]}\" alt=\"img\"></div>` : ''}\n              </div>\n            </div>\n          `\n        })\n        this.state.$list.append(fragment)\n        \n        this.state.skip = this.state.skip + this.state.limit\n        this.state.isFetch = false\n      })\n    }\n    addMore(cb) {\n      const wh = window.innerHeight;\n\n      document.addEventListener(\"scroll\", e => {\n          let lh = this.state.$page.height();\n          if (e.target.documentElement.scrollTop + wh > lh && !this.state.isFetch) cb && cb();\n      });\n    }\n\n    createListFragment(arr, cb){\n      let fragment = document.createDocumentFragment()\n      arr.forEach((v) => {\n        let html = cb && cb(v)\n        fragment.appendChild($(html)[0])\n      })\n\n      return fragment\n    }\n    // render(arr = []){\n    //   let fragment = this.createListFragment(arr)\n    //   this.state.$list.append(fragment)\n    // }\n  }\n\n  new listShow()\n});\n"],"file":"listShow.js"}