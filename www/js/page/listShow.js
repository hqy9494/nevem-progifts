document.addEventListener("DOMContentLoaded",function(){new class extends parent{constructor(){super(),this.state={$page:$("#js-page"),limit:10,skip:0,isFetch:!1,alwayNum:0,noNum:0,sumNum:847,$sumNum:$("#js-sumNum"),$alwayNum:$("#js-alwayNum"),$noNum:$("#js-noNum"),data1:[],$data1:$("#js-data1"),list:[],$list:$("#js-list")},this.init(),this.addMore(this.fetchList.bind(this)),setInterval(()=>{this.fetchData1()},3e5)}init(){this.load()}load(){this.fetchNum().then(t=>{this.state.alwayNum=t||0,this.state.noNum=this.state.sumNum-(t||0),this.state.$sumNum.text(this.state.sumNum),this.state.$alwayNum.text(this.state.alwayNum),this.state.$noNum.text(this.state.noNum)}),this.fetchData1(),this.fetchList()}ready(){}awardType(t){return"material"===t.awardType?t.materialAward&&t.materialAward.name:"taobao_coupon"===t.awardType?`${t.value||0}元优惠券`:"regular_red_bag"===t.awardType||"virtual_red_bag"===t.awardType?`${t.value}元红包`:"buy_times_award"===t.awardType?t.buyTimesAward&&t.buyTimesAward.name:void 0}fetchNum(){return this.fetch({method:"get",url:`${this.baseUriApi}/awardrecords/getCurrentBuyTimesAwardCount`})}fetchData1(){return this.fetch({method:"get",url:`${this.baseUriApi}/awardrecords/getCurrentAwardRecords`}).then(t=>{this.state.data1=t,this.state.$data1.empty();let s=this.createListFragment(t,t=>`\n            <div class="listShow-scroll-item-wrap">\n              <div class="listShow-scroll-item">\n                <img src="assets/img/git.png" alt="img">\n                <span>${t.user&&t.user.nickname||"幸运儿"}</span>\n                <span>${moment(t.createdAt).fromNow()}</span>\n                <span class="listShow-scroll-item-font">抽中${this.awardType(t)}</span>\n              </div>\n            </div>\n          `);this.state.$data1.append(s)})}fetchList(){return this.state.isFetch=!0,this.fetch({method:"get",url:`${this.baseUriApi}/posts`,params:{filter:{type:2,limit:10,skip:this.state.skip}}}).then(t=>{if(!t)return;const s=t;if(!s)return;let e=this.createListFragment(s,t=>t&&`\n            <div class="listShow-user">\n              <div class="listShow-left">\n                <img src=${t.user&&t.user.avatar||"assets/img/avatar.png"} alt="img">\n              </div>\n              <div class="listShow-right">\n                <div class="listShow-right-name">${t.user&&t.user.avatar&&t.user.avatar.nickname||"中奖用户"}</div>\n                <div class="listShow-right-content">${t.titleRaw||""}</div>\n                ${t.images?`<div class="listShow-right-img"><img src="${t.images&&t.images[0]}" alt="img"></div>`:""}\n              </div>\n            </div>\n          `);this.state.$list.append(e),this.state.skip=this.state.skip+this.state.limit,this.state.isFetch=!1})}addMore(t){const s=window.screen.height;document.addEventListener("scroll",e=>{let a=this.state.$page.height();(document.body.scrollTop||e.target.documentElement.scrollTop)+s>a&&!this.state.isFetch&&t&&t()})}createListFragment(t,s){let e=document.createDocumentFragment();return t.forEach(t=>{let a=s&&s(t);e.appendChild($(a)[0])}),e}}});